#!/usr/bin/env ruby
# frozen_string_literal: true

# Allow `require` calls relative to `lib`
$LOAD_PATH.unshift File.expand_path(File.join(File.dirname(__FILE__), '..', 'lib'))

require 'dotenv/load'
require 'secret_santa/csv_parser'
require 'secret_santa/participant'
require 'secret_santa/randomizer'
require 'secret_santa/reporter'
require 'secret_santa/mailer'

mailer = SecretSanta::Mailer.new(
  smtp_host: ENV.fetch('SMTP_HOST', nil),
  smtp_port: ENV.fetch('SMTP_PORT', nil),
  smtp_username: ENV.fetch('SMTP_USERNAME', nil),
  smtp_password: ENV.fetch('SMTP_PASSWORD', nil)
)

from = SecretSanta::EmailAddress.new(name: 'sender', email: 'from@example.com')
to = SecretSanta::EmailAddress.new(name: 'recipient', email: 'to@example.com')

mailer.send_text(
  message_string: 'this is a test email message',
  subject: 'hello world',
  from: from,
  to: to
)

# redact_recipients = false

# csv_path = ARGV.first
# participants = SecretSanta::CsvParser.new(csv_path: csv_path).parse
# reporter = SecretSanta::Reporter.new(redact_recipients: redact_recipients)

# puts 'Generating assignments for the following groups and solo participants'
# puts
# reporter.report_participants(participants: participants)

# randomizer = SecretSanta::Randomizer.new(participants: participants)
# assignments = randomizer.randomize

# reporter.report_assignments(assignments: assignments)

# vim: set ft=ruby
